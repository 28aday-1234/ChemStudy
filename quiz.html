<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChemStudy - Chemistry Quiz</title>
    <link rel="stylesheet" href="quiz-styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="nav-logo" style="text-decoration: none;">
                <span class="logo-icon">‚öóÔ∏è</span>
                <span class="logo-text">ChemStudy</span>
            </a>
            <div class="nav-links">
                <span id="welcomeUser"></span>
                <a href="history.html">History</a>
                <a href="leaderboard.html">Leaderboard</a>
                <a href="#" onclick="logout(); return false;" style="color: #ef4444;">Logout</a>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="header-bar">
            <div>
                <h1>‚öóÔ∏è Chemistry Quiz</h1>
                <p class="subtitle">Test your knowledge and improve your chemistry skills</p>
            </div>
        </div>
        
        <!-- Setup Form -->
        <div id="setupForm" class="setup-form">
            <div class="form-group">
                <label for="topic">Select a Chemistry Topic:</label>
                <select id="txopic" required>
                    <option value="">-- Choose a Topic --</option>
                    <option value="electron-orbitals">Electron Orbitals & Configurations</option>
                    <option value="neon">Neon Element Study</option>
                </select>
            </div>
            <div class="form-group">
                <label for="questionCount">How many questions?</label>
                <input type="number" id="questionCount" min="1" max="20" value="5" required>
            </div>
            <button onclick="startQuiz()">Start Quiz</button>
        </div>

        
        <div id="quizContainer" class="quiz-container hidden">
            <div class="quiz-header">
                <h2 id="quizTopic"></h2>
                <div class="progress">
                    <span id="currentQuestion">1</span> / <span id="totalQuestions">5</span>
                </div>
            </div>
            
            <div id="questionContainer" class="question-container">
                <h3 id="questionText"></h3>
                <div id="answersContainer" class="answers-container"></div>
            </div>
            
            <div class="quiz-actions">
                <button id="nextBtn" onclick="nextQuestion()" class="hidden">Next Question</button>
            </div>
        </div>

        <!-- Results Container -->
        <div id="resultsContainer" class="results-container hidden">
            <h2>Quiz Complete! </h2>
            <div class="score-display">
                <p>Your Score:</p>
                <h1 id="finalScore"></h1>
            </div>
            <button onclick="resetQuiz()">Take Another Quiz</button>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="firebase-config.js"></script>

    <script>
        let currentUser = null;

        // Check if user is logged in
        auth.onAuthStateChanged((user) => {
            if (!user) {
                // Redirect to login page if not logged in
                window.location.href = 'login.html';
            } else {
                // Display user email
                currentUser = user;
                const displayName = user.email.split('@')[0];
                document.getElementById('welcomeUser').textContent = `üë§ ${displayName}`;
            }
        });

        function logout() {
            auth.signOut().then(() => {
                window.location.href = 'login.html';
            }).catch((error) => {
                console.error('Logout error:', error);
            });
        }

        function viewHistory() {
            window.location.href = 'history.html';
        }

        let currentQuestionIndex = 0;
        let score = 0;
        let questions = [];
        let userAnswers = [];

        // Chemistry question database by topic
        const questionDatabase = {
            "electron-orbitals": [
                { q: "Which element has the electron configuration: 1s¬≤?", answers: ["Helium", "Hydrogen", "Lithium", "Beryllium"], correct: 0 },
                { q: "Which element has the electron configuration: 1s¬≤ 2s¬≤?", answers: ["Lithium", "Carbon", "Boron", "Beryllium"], correct: 3 },
                { q: "Which element has the electron configuration: 1s¬≤ 2s¬≤ 2p‚Å∂?", answers: ["Oxygen", "Fluorine", "Neon", "Sodium"], correct: 2 },
                { q: "Which element has the electron configuration: 1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬π?", answers: ["Neon", "Sodium", "Magnesium", "Aluminum"], correct: 2 },
                { q: "Which element has the electron configuration: 1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤?", answers: ["Sodium", "Berrylium", "Magnesium", "Silicon"], correct: 1 },
                { q: "Which element has the electron configuration: 1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p¬π?", answers: ["Magnesium", "Aluminum", "Silicon", "Phosphorus"], correct: 1 },
                { q: "Which element has the electron configuration: 1s¬≤ 2s¬≤ 2p¬π?", answers: ["Lithium", "Beryllium", "Boron", "Carbon"], correct: 2 },
                { q: "Which element has the electron configuration: 1s¬≤ 2s¬≤ 2p¬≤?", answers: ["Carbon", "Boron", "Nitrogen", "Oxygen"], correct: 0 },
                { q: "Which element has the electron configuration: 1s¬≤ 2s¬≤ 2p¬≥?", answers: ["Carbon", "Fluorine", "Oxygen", "Nitrogen"], correct: 3 },
                { q: "Which element has the electron configuration: 1s¬≤ 2s¬≤ 2p‚Å¥?", answers: ["Nitrogen", "Fluorine", "Oxygen", "Neon"], correct: 2 },
                { q: "Which element has the electron configuration: 1s¬≤ 2s¬≤ 2p‚Åµ?", answers: ["Oxygen", "Sodium", "Neon", "Fluorine"], correct: 3 },
                { q: "Which element has the electron configuration: 1s¬≤ 2s¬π?", answers: ["Helium", "Lithium", "Beryllium", "Boron"], correct: 1 },
                { q: "Which element has the electron configuration: [Ne] 3s¬≤ 3p¬≤?", answers: ["Aluminum", "Silicon", "Phosphorus", "Sulfur"], correct: 1 },
                { q: "Which element has the electron configuration: [Ne] 3s¬≤ 3p‚Å¥?", answers: ["Silicon", "Phosphorus", "Chlorine", "Sulfur"], correct: 3 },
                { q: "Which element has the electron configuration: [Ne] 3s¬≤ 3p‚Å∂?", answers: ["Phosphorus", "Sulfur", "Chlorine", "Argon"], correct: 3 },
                { q: "Which element has the electron configuration: [Ar] 4s¬π?", answers: ["Potassium", "Argon", "Calcium", "Scandium"], correct: 0},
                { q: "Which element has the electron configuration: [Ar] 4s¬≤?", answers: ["Calcium", "Potassium", "Scandium", "Titanium"], correct: 0 },
                { q: "How many electrons can the 2p orbital hold?", answers: ["2", "6", "10", "14"], correct: 1 },
                { q: "How many electrons can the 3d orbital hold?", answers: ["2", "6", "10", "14"], correct: 2 },
                { q: "What is the maximum number of electrons in the n=2 shell?", answers: ["2", "8", "18", "32"], correct: 1 }
            ],
            "neon": [
                { q: "What is the atomic number of Neon?", answers: ["8", "9", "10", "11"], correct: 2 },
                { q: "What is the chemical symbol for Neon?", answers: ["N", "Ne", "No", "Nn"], correct: 1 },
                { q: "What group is Neon in on the periodic table?", answers: ["Group 1", "Group 2", "Group 17", "Group 18"], correct: 3 },
                { q: "What is the electron configuration of Neon?", answers: ["1s¬≤ 2s¬≤ 2p‚Å∂", "1s¬≤ 2s¬≤ 2p‚Å¥", "1s¬≤ 2s¬≤ 2p‚Åµ", "1s¬≤ 2s¬≤"], correct: 0 },
                { q: "What category of elements does Neon belong to?", answers: ["Alkali metals", "Halogens", "Noble gases", "Transition metals"], correct: 2 },
                { q: "How many valence electrons does Neon have?", answers: ["2", "6", "8", "10"], correct: 2 },
                { q: "What is the state of Neon at room temperature?", answers: ["Solid", "Liquid", "Gas", "Plasma"], correct: 2 },
                { q: "Is Neon reactive?", answers: ["Highly reactive", "Moderately reactive", "Slightly reactive", "Not reactive"], correct: 3 },
                { q: "What color does Neon glow when electrified?", answers: ["Blue", "Red-orange", "Green", "Yellow"], correct: 1 },
                { q: "How many protons does Neon have?", answers: ["8", "10", "12", "18"], correct: 1 },
                { q: "How many electrons does Neon have?", answers: ["8", "10", "12", "18"], correct: 1 },
                { q: "What is the atomic mass of Neon (approximately)?", answers: ["10", "16", "20", "24"], correct: 2 },
                { q: "Is Neon's outer electron shell full?", answers: ["Yes", "No", "Sometimes", "Unknown"], correct: 0 },
                { q: "What makes Neon stable?", answers: ["Full outer shell", "One valence electron", "Seven valence electrons", "Empty outer shell"], correct: 0 },
                { q: "Where is Neon found naturally?", answers: ["In water", "In rocks", "In the atmosphere", "In soil"], correct: 2 },
                { q: "What percentage of Earth's atmosphere is Neon?", answers: ["About 0.0018%", "About 1%", "About 10%", "About 20%"], correct: 0 },
                { q: "What is the most common isotope of Neon?", answers: ["Ne-18", "Ne-20", "Ne-22", "Ne-24"], correct: 1 },
                { q: "Can Neon form compounds easily?", answers: ["Yes, easily", "Yes, but rarely", "No", "Only with metals"], correct: 2 },
                { q: "What is Neon primarily used for?", answers: ["Medicine", "Lighting/signs", "Fuel", "Food preservation"], correct: 1 },
                { q: "Who discovered Neon?", answers: ["Marie Curie", "William Ramsay", "Dmitri Mendeleev", "Albert Einstein"], correct: 1 }
            ]
        };

        function startQuiz() {
            const topic = document.getElementById('txopic').value;
            const count = parseInt(document.getElementById('questionCount').value);
            
            if (!topic) {
                alert('Please select a chemistry topic!');
                return;
            }

            if (count < 1 || count > 20) {
                alert('Please enter a number between 1 and 20!');
                return;
            }

            // Generate questions
            questions = generateQuestions(topic, count);
            
            // Hide setup form, show quiz
            document.getElementById('setupForm').classList.add('hidden');
            document.getElementById('quizContainer').classList.remove('hidden');
            
            // Update header with topic name
            const topicNames = {
                'electron-orbitals': 'Electron Orbitals & Configurations',
                'neon': 'Neon Element Study'
            };
            document.getElementById('quizTopic').textContent = topicNames[topic] + ' Quiz';
            document.getElementById('totalQuestions').textContent = count;
            
            // Reset state
            currentQuestionIndex = 0;
            score = 0;
            userAnswers = [];
            
            // Load first question
            loadQuestion();
        }

        function generateQuestions(topic, count) {
            let topicQuestions = questionDatabase[topic];
            
            // Shuffle questions for variety
            let shuffled = [...topicQuestions].sort(() => 0.5 - Math.random());
            
            // Select the number of questions requested
            let selectedQuestions = [];
            for (let i = 0; i < count; i++) {
                selectedQuestions.push(shuffled[i % shuffled.length]);
            }
            
            return selectedQuestions;
        }

        function loadQuestion() {
            const question = questions[currentQuestionIndex];
            
            // Update progress
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            
            // Display question
            document.getElementById('questionText').textContent = question.q;
            
            // Display answers
            const answersContainer = document.getElementById('answersContainer');
            answersContainer.innerHTML = '';
            
            question.answers.forEach((answer, index) => {
                const button = document.createElement('button');
                button.className = 'answer-btn';
                button.textContent = answer;
                button.onclick = () => selectAnswer(index);
                answersContainer.appendChild(button);
            });
            
    
            document.getElementById('nextBtn').classList.add('hidden');
        }

        function selectAnswer(selectedIndex) {
            const question = questions[currentQuestionIndex];
            const answerButtons = document.querySelectorAll('.answer-btn');
            
            // Disable all buttons
            answerButtons.forEach((btn, index) => {
                btn.disabled = true;
                if (index === question.correct) {
                    btn.classList.add('correct');
                } else if (index === selectedIndex) {
                    btn.classList.add('wrong');
                }
            });
            
            // Check if answer is correct
            if (selectedIndex === question.correct) {
                score++;
            }
            
            userAnswers.push(selectedIndex);
            
            // Show next button
            document.getElementById('nextBtn').classList.remove('hidden');
        }

        function nextQuestion() {
            currentQuestionIndex++;
            
            if (currentQuestionIndex < questions.length) {
                loadQuestion();
            } else {
                showResults();
            }
        }

        function showResults() {
            document.getElementById('quizContainer').classList.add('hidden');
            document.getElementById('resultsContainer').classList.remove('hidden');
            
            const percentage = Math.round((score / questions.length) * 100);
            document.getElementById('finalScore').textContent = `${score} / ${questions.length} (${percentage}%)`;
            
            saveQuizResult(score, questions.length, percentage);
        }

        function saveQuizResult(score, totalQuestions, percentage) {
            if (!currentUser) {
                console.error('No user logged in');
                return;
            }

            const topic = document.getElementById('txopic').value;
            const topicNames = {
                'electron-orbitals': 'Electron Orbitals & Configurations',
                'neon': 'Neon Element Study'
            };

            const quizData = {
                userId: currentUser.uid,
                userEmail: currentUser.email,
                topic: topicNames[topic] || topic,
                score: score,
                totalQuestions: totalQuestions,
                percentage: percentage,
                timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                date: new Date().toISOString()
            };

            // Save to quiz history
            db.collection('quizHistory').add(quizData)
                .then((docRef) => {
                    console.log('Quiz result saved with ID:', docRef.id);
                })
                .catch((error) => {
                    console.error('Error saving quiz result:', error);
                });

            // Update leaderboard
            updateLeaderboard(score, totalQuestions, percentage);
        }

        function updateLeaderboard(score, totalQuestions, percentage) {
            const leaderboardRef = db.collection('leaderboard').doc(currentUser.uid);
            
            leaderboardRef.get().then((doc) => {
                if (doc.exists) {
                    // Update existing entry
                    const data = doc.data();
                    const newTotalScore = (data.totalScore || 0) + score;
                    const newTotalQuestions = (data.totalQuestions || 0) + totalQuestions;
                    const newQuizzesTaken = (data.quizzesTaken || 0) + 1;
                    const newAverageScore = Math.round((newTotalScore / newTotalQuestions) * 100);

                    leaderboardRef.update({
                        totalScore: newTotalScore,
                        totalQuestions: newTotalQuestions,
                        quizzesTaken: newQuizzesTaken,
                        averageScore: newAverageScore,
                        lastQuizDate: firebase.firestore.FieldValue.serverTimestamp()
                    });
                } else {
                    // Create new entry
                    leaderboardRef.set({
                        userId: currentUser.uid,
                        userEmail: currentUser.email,
                        displayName: currentUser.email.split('@')[0],
                        totalScore: score,
                        totalQuestions: totalQuestions,
                        quizzesTaken: 1,
                        averageScore: percentage,
                        lastQuizDate: firebase.firestore.FieldValue.serverTimestamp(),
                        joinedDate: firebase.firestore.FieldValue.serverTimestamp()
                    });
                }
            }).catch((error) => {
                console.error('Error updating leaderboard:', error);
            });
        }

        function resetQuiz() {
            document.getElementById('resultsContainer').classList.add('hidden');
            document.getElementById('setupForm').classList.remove('hidden');
            document.getElementById('txopic').value = '';
            document.getElementById('questionCount').value = 5;
        }

        function capitalizeFirst(str) {
            return str.charAt(0).toUpperCase() + str.slice(1);
        }
    </script>
</body>
</html>

